#! /usr/bin/env python3

import ruamel.yaml
import sys
import io


class ProvisioningPlaybook(object):
    def __init__(self, packages):
        self.hosts = 'all'
        self.become = 'yes'
        self.become_user = 'root'
        self.tasks = list()
        for p in packages:
            self.tasks.append({'name':p,"package":{"name":p,"state":"present"}})


    def get_playbook(self):
        yaml = ruamel.yaml.YAML()

        #creating yaml from ProvisioningPlaybook class
        yaml.register_class(ProvisioningPlaybook)
        stream = io.StringIO()
        playbook = self

        #dumping the class
        yaml.dump([playbook], stream)

        #removing '- !Playbook' line
        playbook = stream.getvalue().split("\n")[1:]

        #to string
        playbook[0] = playbook[0].replace("  hosts","- hosts")
        playbook = '\n'.join(playbook)
        return playbook



#packages = ['nmap','git','sqlmap']
#playbook = ProvisioningPlaybook(packages)
#print(playbook.get_playbook())
