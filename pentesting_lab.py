#! /usr/bin/env python3

import sys
import os
import vagrant


class Host:
    def __init__(self, name, box_name, provisioning_type):
        self.name = name
        self.box_name = box_name
        self.path = "./"+name
        self.provisioning_type = provisioning_type

    def configure(self):
        os.mkdir(self.path, mode=0o755)
        os.chdir(self.path)
        self.v = vagrant.Vagrant()
        self.v.init(self.box_name)
        os.chdir("..")

    def provision(self):
        return False

    def up(self):
        os.chdir(self.path)
        for s in self.v.up(stream_output=True):
            print(s, end='')
        os.chdir("..")

    def halt(self):
        os.chdir(self.path)
        self.v.halt()
        os.chdir("..")

    def cmd(self, command):
        os.chdir(self.path)
        result = self.v.ssh(command=command)
        os.chdir("..")
        return result


def startup():
    f = open("boxes.txt","r")
    boxes = list(filter(None, f.read().split("\n")))
    return boxes


boxes = startup()
index = 1
print("Select box type:")
for b in boxes:
    print(str(index),b)
    index += 1
index = int(input("> ")) - 1
print("Insert host name:")
name = input("> ")


#v = Host(name="machine01", box_name="generic/debian9")
v = Host(name=name, box_name=boxes[index])
v.configure()
v.up()
result = v.cmd("whoami")
v.halt()
print(result)
