#! /usr/bin/env python3

import subprocess
import json
import pentesting_lab.core.preferences

switch_folder = pentesting_lab.core.preferences.switches_path

class VdeSwitch:
    def __init__(self, fd):
        self.name = fd
        self.fd = switch_folder + "/" + self.name

    def create_switch(self):
        cmd = ["vde_switch","-s",self.fd]
        self.p = subprocess.Popen(cmd, stdin=subprocess.DEVNULL, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    def halt_switch(self):
        self.p.terminate()
    
    def get_iface(self):
        return self.fd

    def serialize(self):
        return json.dumps({"fd":self.name})

    def __repr__(self):
        result = "\n----------------\n"
        result += "VdeSwitch: {}".format(self.fd)
        return result

